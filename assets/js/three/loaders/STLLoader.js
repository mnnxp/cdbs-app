import{BufferAttribute as e,BufferGeometry as t,Color as r,FileLoader as n,Float32BufferAttribute as o,Loader as i,Vector3 as l,SRGBColorSpace as s}from"../three.module.min.js";class STLLoader extends i{constructor(e){super(e)}load(e,t,r,o){let i=this,l=new n(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(r){try{t(i.parse(r))}catch(n){o?o(n):console.error(n),i.manager.itemError(e)}},r,o)}parse(n){var i;function $(e,t,r){for(let n=0,o=e.length;n<o;n++)if(e[n]!==t.getUint8(r+n))return!1;return!0}let a=function e(t){if("string"!=typeof t)return t;{let r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=255&t.charCodeAt(n);return r.buffer||r}}(n);return!function e(t){let r=new DataView(t),n=r.getUint32(80,!0);if(84+50*n===r.byteLength)return!0;let o=[115,111,108,105,100];for(let i=0;i<5;i++)if($(o,r,i))return!1;return!0}(a)?function e(r){let n=new t,i=/solid([\s\S]*?)endsolid/g,s=/facet([\s\S]*?)endfacet/g,$=/solid\s(.+)/,a=0,u=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,f=RegExp("vertex"+u+u+u,"g"),g=RegExp("normal"+u+u+u,"g"),_=[],h=[],c=[],d=new l,w,p=0,x=0,m=0;for(;null!==(w=i.exec(r));){x=m;let b=w[0],F=null!==(w=$.exec(b))?w[1]:"";for(c.push(F);null!==(w=s.exec(b));){let U=0,L=0,y=w[0];for(;null!==(w=g.exec(y));)d.x=parseFloat(w[1]),d.y=parseFloat(w[2]),d.z=parseFloat(w[3]),L++;for(;null!==(w=f.exec(y));)_.push(parseFloat(w[1]),parseFloat(w[2]),parseFloat(w[3])),h.push(d.x,d.y,d.z),U++,m++;1!==L&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+a),3!==U&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+a),a++}let S=x,T=m-x;n.userData.groupNames=c,n.addGroup(S,T,p),p++}return n.setAttribute("position",new o(_,3)),n.setAttribute("normal",new o(h,3)),n}("string"!=typeof(i=n)?new TextDecoder().decode(i):i):function n(o){let i=new DataView(o),l=i.getUint32(80,!0),$,a,u,f=!1,g,_,h,c,d;for(let w=0;w<70;w++)1129270351==i.getUint32(w,!1)&&82==i.getUint8(w+4)&&61==i.getUint8(w+5)&&(f=!0,g=new Float32Array(9*l),_=i.getUint8(w+6)/255,h=i.getUint8(w+7)/255,c=i.getUint8(w+8)/255,d=i.getUint8(w+9)/255);let p=new t,x=new Float32Array(9*l),m=new Float32Array(9*l),b=new r;for(let F=0;F<l;F++){let U=84+50*F,L=i.getFloat32(U,!0),y=i.getFloat32(U+4,!0),S=i.getFloat32(U+8,!0);if(f){let T=i.getUint16(U+48,!0);(32768&T)==0?($=(31&T)/31,a=(T>>5&31)/31,u=(T>>10&31)/31):($=_,a=h,u=c)}for(let A=1;A<=3;A++){let E=U+12*A,C=9*F+(A-1)*3;x[C]=i.getFloat32(E,!0),x[C+1]=i.getFloat32(E+4,!0),x[C+2]=i.getFloat32(E+8,!0),m[C]=L,m[C+1]=y,m[C+2]=S,f&&(b.setRGB($,a,u,s),g[C]=b.r,g[C+1]=b.g,g[C+2]=b.b)}}return p.setAttribute("position",new e(x,3)),p.setAttribute("normal",new e(m,3)),f&&(p.setAttribute("color",new e(g,3)),p.hasColors=!0,p.alpha=d),p}(a)}}export{STLLoader};